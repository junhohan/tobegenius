# mqtt : mosquitto


## Keep Alive
Keep Alive는 초(Seconds) 단위 시간 간격을 의미한다. 16비트 값이며 마지막 제어 패킷을 전송한 시점에서 다음에 전송할 시점까지의 간격이 허용되는 최대 값(초)으로 사용된다. 즉, 클라이언트A가 보낸 마지막 제어 패킷과 그 다음 패킷의 시간 차이을 t(초)라고 하면 `t < Keep Alive Value`이어야 한다. 그렇지 않으면 서버(mqtt bridge)는 클라이언트A가 접속이 끊였다고 판단한다. 이 때문에 클라이언트는 Keep Alive 값을 초과하지 않도록 그 전에 제어 패킷을 꼭 보내야 한다. 접속을 장시간 유지해야 하는데 한 동안 어떠한 패킷도 보내지 않았다면 `PINGREQ  Packet`을 보내야한다. `PINGREQ  Packet`은 Keep Alive 값과 상관없이 언제든 전송할 수 있다. PINGREQ의 결과로 `PINGRESP Packet`이 수신되면 서버와 연결이 잘 되고 있다고 판단하면 된다. 일정시간 동안 `PINGRESP`가 수신되지 않으면 클라이언트는 서버와 네트워크 연결을 끊어야 한다.  

Keep Alive 값을 0으로 설정하면 Keep Alive 메커니즘이 해제된다. 이 경우 서버는 비활성 상태에 있는 클라이언트의 연결을 끊지 않아도 된다. 하지만, 클라이언트가 전송한 정보와 상관없이, 서버는 비활성 또는 응답하지 않는다고 판단할 때 언제든지 연결을 끊을 수 있다. 이 점을 유의해야 한다.